<!DOCTYPE html>
<html lang="en">
  <%- include("head.ejs", {title: "Admin: Notifications"}) %>
  <body>
    <%- include("navbar.ejs") %>

    <style>
      * {
        word-wrap: break-word;
      }

      .body-container {
        padding-left: 0;
        padding-right: 0;
        max-width: 100vw;
      }

      table {
        width: 1000px;
        border-collapse: collapse;
        margin: 20px auto;
      }

      .new {
        width: 1000px;
        margin: 50px auto;
      }

      form .input input {
        width: 500px;
      }

      form .half {
        width: 500px;
        display: flex;
        justify-content: space-between;
        margin-top: -20px;
      }

      form .half .input {
        width: 45%;
      }

      form .half .input input {
        width: 100%;
      }

      thead tr {
        font-size: 1.1rem;
        font-family: "Sen", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
        text-transform: uppercase;
      }

      td {
        border: none;
      }

      thead tr td {
        background: #2977f5;
        color: #eaeaef;
      }

      thead tr td:first-of-type {
        border-radius: 5px 0 0 0;
      }

      thead tr td:last-of-type {
        border-radius: 0 5px 0 0;
      }

      tbody tr:last-of-type td:first-of-type {
        border-radius: 0 0 0 5px;
      }

      tbody tr:last-of-type td:last-of-type {
        border-radius: 0 0 5px 0;
      }

      tbody tr:nth-child(odd) {
        background: #333;
      }

      td {
        padding: 15px 20px;
        text-align: center;
      }

      td:nth-child(1) {
        width: 5%;
      }
      td:nth-child(2) {
        width: 30%;
      }
      td:nth-child(3) {
        width: 30%;
      }
      td:nth-child(4) {
        width: 15%;
      }
      td:nth-child(5) {
        width: 10%;
      }
      td:nth-child(6) {
        width: 10%;
      }

      td:last-child a {
        padding: 10px 15px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      td:last-child a:hover {
        background: #2977f510;
      }
    </style>

    <div class="body-container">
      <table>
        <thead>
          <tr>
            <td></td>
            <td>Content</td>
            <td></td>
          </tr>
        </thead>
        <tbody>
          <% for(let i = 0; i < notifications.length; i++) { %>
          <tr>
            <td><%- i + 1 %></td>
            <td><%- notifications[i].content %></td>
            <td>
              <a href="/admin/notifications/<%- notifications[i].id %>?l=<%- i + 1 %>">Edit</a>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>

      <div class="new" style="margin-top: 50px">
        <h2>New Level</h2>
        <form action="/admin/notifications/new" method="post">
          <input type="hidden" name="_csrf" value="<%- csrfToken %>" />
          <div class="input">
            <label for="content">Content</label>
            <textarea placeholder="Who is our God?" name="content"></textarea>
          </div>

          <button type="submit">Add</button>
        </form>
      </div>
    </div>

    <%- include("footer.ejs") %>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io();

      const textarea = document.querySelector("textarea[name='content']");
      const form = document.querySelector("form");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        socket.emit("notifs:create", {id: parseInt(<%- notifications.length %>) + 1, content: textarea.value, createdAt: new Date()});
        form.submit();
      })
    </script>
  </body>
</html>
